---
layout: post
tags: system
title: Tricard - Malware sanboxes fingerprinting
---

Introduction to malware sandboxes fingerprinting


{:refdef: style="text-align: center;"}
![_config.yml]({{ site.base}}/images/tricard/tricard.jpg)
{: refdef}

# TLDR;

> &rarr; Security software: I will protect your system and defend against malicious activity!<br>
> &rarr; Malware: I will detect and evade your defenses!<br>
> &rarr; Security software: I will then detect your detection mechanisms!<br>
> &rarr; Malware: I will .. uh.. <br>



{:refdef: style="text-align: center;"}
![_config.yml]({{ site.base}}/images/tricard/spiderman_meme.jpg)
{: refdef}

# Table of contents:



# 1. Compile and dispatch
All data is concatenated in a JSON array. As it can be very heavy very quickly, the JSON payload POST requests are compressed using Zlib. The client and server are configured to communicate over HTTPS.
# 1.1 Collector functions

### 1. `ListProcessesToJson(char* jsonData, size_t jsonDataLen)`: 
- **Overview:**
  - Lists running processes on the system.
  - Appends process information, including process name, to a JSON-formatted string.
  - JSON data is stored in the provided `jsonData` buffer.

### 2. `ListLoadedModulesToJson(char* jsonData, size_t jsonDataLen)`:
- **Overview:**
  - Lists loaded modules (DLLs) in running processes.
  - Appends module information, including module name, to a JSON-formatted string.
  - JSON data is stored in the provided `jsonData` buffer.

### 3. `GetPSHistory(char* jsonData, int jsonDataLen)`:
- **Overview:**
  - Retrieves PowerShell command history.
  - Encodes history in base64 and appends it to a JSON-formatted string.
  - JSON data is stored in the provided `jsonData` buffer.

### 4. `GetSysinfo(char* jsonData, int jsonDataLen)`:
- **Overview:**
  - Retrieves various system information (OS version, architecture, user information).
  - Encodes information in base64 and appends it to a JSON-formatted string.
  - JSON data is stored in the provided `jsonData` buffer.

### 5. `GetNetworkInterfacesJSON(char* jsonBuffer, size_t bufferSize)`:
- **Overview:**
  - Retrieves network interface information (MAC addresses, IP addresses).
  - Appends information to a JSON-formatted string.
  - JSON data is stored in the provided `jsonBuffer` buffer.

### 6. `GetBasicInfo(char* jsonData)`:
- **Overview:**
  - Retrieves basic system information (computer name, username, domain).
  - Initializes JSON data, storing it in the provided `jsonData` buffer.

### 7. `LoopFolders(char* jsonData)`:
- **Overview:**
  - Loops through specified folders (temporary folder and desktop).
  - Lists files in these folders, including details like filename, type, magic number, creation date, and modification date.
  - Appends file information to a JSON-formatted string stored in the provided `jsonData` buffer.

### 8. `SendGzipCompressedPOSTRequest(const char* postData)`:
- **Overview:**
  - Sends a POST request to a specified server with Gzip-compressed data.
  - Uses WinHTTP functions to open a session, connect, and send the request.
  - Compression is done using the zlib library.

### 9. `main()`:
- **Overview:**
  - Main function that orchestrates the collection and transmission of system information.
  - Calls various functions to gather and format system information.
  - Initiates a Gzip-compressed POST request to send the data to a server.


# 1.2 JSON Structure
# 1.3 Compiled binaries
# 2. Examples
# 3. Server setup
# 3.1 Registering a new tricard sample
{:refdef: style="text-align: center;"}
![_config.yml]({{ site.base}}/images/tricard/uuid_match.jpg)
{: refdef}
# 3.2 JSON samples database


Stay classy netsecurios, and happy Rememberance Day!

---
November 2023
---
